import{p as y,b as m,i as A}from"./index-5296bee9.js";const G=y("gameStats",()=>{const t=m({totalGames:0,wins:0,bestTimes:{beginner:null,intermediate:null,expert:null,custom:null},recentGames:[]});function s(){const v=localStorage.getItem("minesweeper-stats");v&&(t.value=JSON.parse(v))}function g(){localStorage.setItem("minesweeper-stats",JSON.stringify(t.value))}function h(v,c,a){let f="custom";a.width===9&&a.height===9&&a.mines===10?f="beginner":a.width===16&&a.height===16&&a.mines===40?f="intermediate":a.width===30&&a.height===16&&a.mines===99&&(f="expert"),t.value.totalGames++,v&&(t.value.wins++,(!t.value.bestTimes[f]||c<t.value.bestTimes[f])&&(t.value.bestTimes[f]=c)),t.value.recentGames.unshift({difficulty:f,won:v,time:c,date:Date.now()}),t.value.recentGames.length>10&&(t.value.recentGames=t.value.recentGames.slice(0,10)),g()}return s(),{statistics:t,recordGame:h}}),k=y("game",()=>{const t=m("idle"),s=m([]),g=m(0),h=m(0),v=m(0),c=m(null),a=m({width:9,height:9,mines:10}),f=A(()=>g.value-h.value);function R(i){a.value=i,t.value="idle",g.value=i.mines,h.value=0,v.value=0,s.value=x()}function x(){const{width:i,height:n}=a.value;return Array(n).fill(null).map(()=>Array(i).fill(null).map(()=>({isMine:!1,isRevealed:!1,isFlagged:!1,neighborMines:0})))}function M(i,n){const{width:e,height:l,mines:u}=a.value;let r=0;for(;r<u;){const o=Math.floor(Math.random()*e),d=Math.floor(Math.random()*l);!s.value[d][o].isMine&&(Math.abs(o-i)>1||Math.abs(d-n)>1)&&(s.value[d][o].isMine=!0,r++)}for(let o=0;o<l;o++)for(let d=0;d<e;d++)s.value[o][d].isMine||(s.value[o][d].neighborMines=F(d,o))}function F(i,n){let e=0;for(let l=-1;l<=1;l++)for(let u=-1;u<=1;u++){const r=n+l,o=i+u;r>=0&&r<a.value.height&&o>=0&&o<a.value.width&&s.value[r][o].isMine&&e++}return e}function S(){c.value||(c.value=setInterval(()=>{v.value++},1e3))}function w(){c.value&&(clearInterval(c.value),c.value=null)}function p(i,n){t.value==="idle"&&(t.value="playing",M(i,n),S());const e=s.value[n][i];if(!(e.isRevealed||e.isFlagged)){if(e.isRevealed=!0,e.isMine){t.value="lost",N(),w(),G().recordGame(!1,v.value,a.value);return}e.neighborMines===0&&T(i,n),b()}}function T(i,n){for(let e=-1;e<=1;e++)for(let l=-1;l<=1;l++){const u=n+e,r=i+l;u>=0&&u<a.value.height&&r>=0&&r<a.value.width&&!s.value[u][r].isRevealed&&p(r,u)}}function I(i,n){if(t.value!=="playing"&&t.value!=="idle")return;const e=s.value[n][i];e.isRevealed||(e.isFlagged=!e.isFlagged,h.value+=e.isFlagged?1:-1,t.value==="idle"&&(t.value="playing",S()),b())}function b(){const{width:i,height:n}=a.value;let e=!0;for(let l=0;l<n;l++)for(let u=0;u<i;u++){const r=s.value[l][u];if(!r.isMine&&!r.isRevealed){e=!1;break}}e&&(t.value="won",w(),G().recordGame(!0,v.value,a.value))}function N(){const{width:i,height:n}=a.value;for(let e=0;e<n;e++)for(let l=0;l<i;l++)s.value[e][l].isMine&&(s.value[e][l].isRevealed=!0)}return{gameState:t,board:s,mineCount:g,flaggedCount:h,timer:v,placeMines:M,remainingMines:f,config:a,initializeGame:R,revealCell:p,toggleFlag:I}});export{k as u};
